<!DOCTYPE html>
<html>
<head>
    <title>Real WASM Runner</title>
    <style>
        body { font-family: monospace; margin: 20px; }
        #output { background: black; color: lime; padding: 20px; min-height: 300px; white-space: pre-wrap; }
        .btn { padding: 10px 20px; margin: 10px; font-size: 16px; }
    </style>
</head>
<body>
    <h1>ğŸ”´WASM Runner</h1>
    <input type="file" id="wasmFile" accept=".wasm">
    <button class="btn" onclick="runWasm()">â–¶ï¸ RUN WASM</button>
    <button class="btn" onclick="clearOutput()">ğŸ—‘ï¸ CLEAR</button>
    
    <h3>Output:</h3>
    <div id="output">Select .wasm file and click RUN</div>

    <script>
        let wasmInstance = null;
        const output = document.getElementById('output');

        const importObject = {
            env: {
                printInt: (value) => output.textContent += `Integer: ${value}\n`,
                printFloat: (value) => output.textContent += `Float: ${value}\n`,
                printString: (ptr) => {
                    if (!wasmInstance) return;
                    const memory = new Uint8Array(wasmInstance.exports.memory.buffer);
                    let str = '';
                    for (let i = ptr; memory[i] !== 0; i++) {
                        str += String.fromCharCode(memory[i]);
                    }
                    output.textContent += `String: ${str}\n`;
                },
                printBool: (value) => output.textContent += `Boolean: ${value ? 'true' : 'false'}\n`,
                printNewline: () => output.textContent += '\n'
            }
        };

        async function runWasm() {
            const fileInput = document.getElementById('wasmFile');
            if (!fileInput.files[0]) {
                output.textContent = 'âŒ Select .wasm file first';
                return;
            }

            output.textContent = 'Loading WASM...\n';
            
            try {
                const file = fileInput.files[0];
                const arrayBuffer = await file.arrayBuffer();
                const wasmModule = await WebAssembly.instantiate(arrayBuffer, importObject);
                
                wasmInstance = wasmModule.instance;
                output.textContent += 'WASM loaded\n';
                output.textContent += `Exports: ${Object.keys(wasmInstance.exports).join(', ')}\n`;
                
                if (wasmInstance.exports.main) {
                    output.textContent += 'Calling main()...\n';
                    output.textContent += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
                    wasmInstance.exports.main();
                    output.textContent += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
                    output.textContent += 'Program finished\n';
                } else {
                    output.textContent += 'âŒ No main() function\n';
                }
            } catch (error) {
                output.textContent += `âŒ Error: ${error.message}\n`;
            }
        }

        function clearOutput() {
            output.textContent = '';
        }
    </script>
</body>
</html>